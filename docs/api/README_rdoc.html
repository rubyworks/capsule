<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>File: README.rdoc [&quot;Capsule&quot;]</title>

  <link rel="SHORTCUT ICON" href="./assets/icon/file.png">

  <link type="text/css" rel="stylesheet" href="./assets/rdoc.css" media="screen" />
  <link type="text/css" rel="stylesheet" href="./assets/highlight/styles/github.css" title="GitHub" />

  <script type="text/javascript" charset="utf-8" src="./assets/jquery.js"></script>
  <script type="text/javascript" charset="utf-8" src="./assets/highlight/highlight.pack.js"></script>
  <script type="text/javascript" charset="utf-8" src="./assets/quicksearch.js"></script>
  <script type="text/javascript" charset="utf-8" src="./assets/main.js"></script>

  <script type="text/javascript">
    $(document).ready( function() {
      $('#documentation pre').wrapInner('<code></code>');
      hljs.tabReplace = '    ';
      hljs.initHighlightingOnLoad('ruby');

	    hookSourceViews();
	    hookDebuggingToggle();
	    hookQuickSearch();
	    highlightLocationTarget();

	    $('ul.link-list a').bind( "click", highlightClickTarget );
    });
  </script>
</head>

<body class="file"> <!-- .file-popup is no more -->
<div id="main">

  <div class="head">
    <h1>
      <img src="./assets/icon/file.png" align="absmiddle">&nbsp;
      <a href="./index.html">&quot;Capsule&quot;</a>&nbsp;
      <a href="/">README.rdoc</a>
    </h1>
  </div>

  <div id="metadata">
    <div id="file-stats-section" class="section">
      <h3 class="section-header">File Stats</h3>
      <dl>
        <dt class="modified-date">Last Modified</dt>
        <dd class="modified-date">Thu May 12 13:59:40 -0400 2011</dd>

        

        
      </dl>
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Information</h3>
        <ul>
        
          <li class="file"><a href="./COPYING_rdoc.html">COPYING.rdoc</a></li>
        
          <li class="file"><a href="./HISTORY_rdoc.html">HISTORY.rdoc</a></li>
        
          <li class="file"><a href="./README_rdoc.html">README.rdoc</a></li>
        
          <li class="file"><a href="./AGPL3_txt.html">AGPL3.txt</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class Index
          <span class="search-toggle"><img src="./assets/icon/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li class="class"><a href="./Capsule.html">Capsule</a></li>
        
          <li class="class"><a href="./Capsule/MissingFile.html">Capsule::MissingFile</a></li>
        
          <li class="module"><a href="./Kernel.html">Kernel</a></li>
        
          <li class="class"><a href="./Module.html">Module</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      <!-- METHODS -->
      <div id="methodindex-section" class="section project-section">
        <h3 class="section-header">Method Index</h3>
        <ul>
          
            
            <li class="singleton" style="clear: both;">
              <span class="method-parent-aside">Capsule</span>
              <a href="Capsule.html#method-c-load">::load</a>
            </li>
          
            
            <li class="singleton" style="clear: both;">
              <span class="method-parent-aside">Capsule</span>
              <a href="Capsule.html#method-c-new">::new</a>
            </li>
          
            
            <li class="method" style="clear: both;">
              <span class="method-parent-aside">Kernel</span>
              <a href="Kernel.html#method-i-autoimport">#autoimport</a>
            </li>
          
            
            <li class="method" style="clear: both;">
              <span class="method-parent-aside">Capsule</span>
              <a href="Capsule.html#method-i-include">#include</a>
            </li>
          
            
            <li class="method" style="clear: both;">
              <span class="method-parent-aside">Capsule</span>
              <a href="Capsule.html#method-i-include_script">#include_script</a>
            </li>
          
            
            <li class="method" style="clear: both;">
              <span class="method-parent-aside">Capsule</span>
              <a href="Capsule.html#method-i-load">#load</a>
            </li>
          
            
            <li class="method" style="clear: both;">
              <span class="method-parent-aside">Capsule</span>
              <a href="Capsule.html#method-i-load_in_module">#load_in_module</a>
            </li>
          
            
            <li class="method" style="clear: both;">
              <span class="method-parent-aside">Capsule</span>
              <a href="Capsule.html#method-i-load_path_lookup">#load_path_lookup</a>
            </li>
          
            
            <li class="method" style="clear: both;">
              <span class="method-parent-aside">Capsule</span>
              <a href="Capsule.html#method-i-require">#require</a>
            </li>
          
        </ul>
      </div>
    </div>

    <div id="validator-badges">
      
      <div style="float: right; margin-right: 5px;">
        <a href="http://validator.w3.org/check/referer"><img src="./assets/icon/check.png" alt="[Validate]" height="16" width="16" /></a>
      </div>
      Generated with <a href="http://rubyworks.github.com/newfish">Newfish</a> 0.2.0
      <br/><br/>
    </div>
  </div>

  <!-- .file-popup was wrapped:
    <div id="documentation">
      
      <div class="description">
          ... file.description ...
      </div>
      
    </div>
   So maybe that css is no longer needed.
   -->

  <div id="documentation">
    
<h1><a href="Capsule.html">Capsule</a></h1>

<h2>Description</h2>

<p><a href="Capsule.html">Capsule</a> is a subclass of <a
href="Module.html">Module</a>. A module which is an instance of the <a
href="Capsule.html">Capsule</a> class encapsulates in its scope the
top-level methods, top-level constants, and instance variables defined in a
Ruby script (and its dependent files) loaded by a Ruby program. This allows
use of script files to define objects that can be loaded into a program in
much the same way that objects can be loaded from YAML or Marshaled files.
There is also an autoimport method which functions like Ruby’s autoload
but based on is <a href="Capsule.html#method-c-load">Capsule.load</a>.</p>

<h2>Resources</h2>
<ul><li>
<p>home: <a
href="http://rubyworks.github.com/capsule">rubyworks.github.com/capsule</a></p>
</li><li>
<p>work: <a
href="http://github.com/rubyworks/capsule">github.com/rubyworks/capsule</a></p>
</li><li>
<p>mail: <a
href="http://groups.google.com/group/rubyworks-mailinglist">groups.google.com/group/rubyworks-mailinglist</a></p>
</li></ul>

<h2>Synopsis</h2>

<p>To encapsulate a script in a Capsule:</p>

<pre>myscript = Capsule.new('myscript.rb')</pre>

<p>If the script is in Ruby’s $LOAD_PATH, then you can use <tt><a
href="Capsule.html#method-c-load">Capsule.load</a></tt>.</p>

<pre>myscript = Capsule.load('myscript.rb')</pre>

<p>Here is an example:</p>

<pre># myscript.rb

VALUE = [1,2,3]

def run
  puts &quot;#{self} is running.&quot;
end</pre>

<p>And the encapsulating program:</p>

<pre># program.rb:

require 'capsule'

myscript = Capsule.load(&quot;myscript.rb&quot;)

p myscript::VALUE

myscript.run</pre>

<p>Running `program.rb` will result in:</p>

<pre>$ ruby program.rb
[1, 2, 3]
#&lt;Capsule:myscript.rb&gt; is running.</pre>

<h2>Usage</h2>

<p><a href="Capsule.html">Capsule</a> modules are instantiated with <tt><a
href="Capsule.html#method-c-new">Capsule.new(main_file)</a></tt> or the
alias <tt><a
href="Capsule.html#method-c-load">Capsule.load(main_file)</a></tt>. All the
top-level constants and top-level methods that are defined in the
<tt>main_file</tt> and its dependent local files (see below) are scoped in
the same <a href="Capsule.html">Capsule</a> module, and are thereby
available to the calling program.</p>

<p>The <tt>main_file</tt> can load or require other files with <tt>load</tt>
and <tt>require</tt>, as usual. These methods, in the <a
href="Capsule.html">Capsule</a> context, add some behavior to the <tt><a
href="Kernel.html">Kernel</a></tt> <tt>load</tt> and <tt>require</tt>
methods: <tt><a href="Capsule.html#method-i-load">Capsule#load</a></tt> and
<tt><a href="Capsule.html#method-i-require">Capsule#require</a></tt> first
search for files relative to the <tt>main_file</tt>‘s dir. Files loaded
in this way (“dependent local files”) are treated like the script file
itself: top-level definitions are added to the script module that is
returned by <tt>load</tt> or <tt>require</tt>.</p>

<p>Both <tt><a href="Capsule.html#method-i-load">Capsule#load</a></tt> and
<tt><a href="Capsule.html#method-i-require">Capsule#require</a></tt> fall
back to the <a href="Kernel.html">Kernel</a> versions if the file is not
found locally. Hence, other ruby libraries can be loaded and required as
usual, assuming their names do not conflict with local file names.
Definitions from those files go into the usual scope (typically global).
The normal ruby <tt>load</tt> and <tt>require</tt> behavior can be forced
by calling <tt>Kernel.load</tt> and <tt>Kernel.require</tt>.</p>

<p>A <a href="Capsule.html">Capsule</a> immitates the way the top-level ruby
context works, so a ruby file that was originally intended to be run from
the top level, defining top-level constants and top-level methods, can also
be run as a <a href="Capsule.html">Capsule</a>, and its top-level constants
and top-level methods are wrapped in the script’s scope. The difference
between this behavior and simply wrapping the loaded definitions in an
<em>anonymous</em> module using <tt>Kernel.load(main_file, true)</tt> is
that the top-level methods and top-level constants defined in the script
are accessible using the <a href="Capsule.html">Capsule</a> instance.</p>

<p>The top-level definitions of a <a href="Capsule.html">Capsule</a> can be
accessed after it has been loaded, as follows:</p>

<p><tt>script.meth</tt></p>
<ul><li>
<p>Call a method defined using <tt>def meth</tt> or <tt>def self.meth</tt> in
the script file.</p>
</li></ul>

<p><tt>script::K</tt></p>
<ul><li>
<p>Access a class, module, or constant defined using <tt>K = val</tt> in the
script file.</p>
</li></ul>

<p>An “input” can be passed to the script before loading. Simply call <a
href="Capsule.html#method-c-new">Capsule.new</a> (or <a
href="Capsule.html#method-c-load">Capsule.load</a>) with a block. The block
is passed a single argument, the <a href="Capsule.html">Capsule</a> module,
and executed before the files are loaded into the Capsule’s scope.
Setting a constant in this block makes the constant available to the script
during loading. For example:</p>

<pre>script = Capsule.load(&quot;my-script.rb&quot;) { |capsule| capsule::INPUT = 3 }</pre>

<p>Note that all methods defined in the script file are both instance methods
of the module and methods of the module instance (the effect of
<tt>Module#module_function</tt>). So <tt>include</tt>-ing a <a
href="Capsule.html">Capsule</a> module in a class will give instances of
the class all the methods and constants defined in the script, and they
will reference the instance’s instance variables, rather than the <a
href="Capsule.html">Capsule</a> module’s instance variables.</p>

<p>The <a href="Capsule.html">Capsule</a> class was inspired by Nobu
Nokada’s suggestion in <a
href="http://ruby-talk.org/62727">ruby-talk.org/62727</a>, in a thread
(started in <a href="http://ruby-talk.org/62660">ruby-talk.org/62660</a>)
about how to use ruby script files as specifications of objects.</p>

<h2>Installation</h2>

<p>To install with RubyGems simply open a console and type:</p>

<pre>gem install capsule</pre>

<p>Local installation requires Setup.rb (gem install setup), then download the
tarball package and type:</p>

<pre>tar -xvzf capsule-1.0.0.tgz
cd capsule-1.0.0
sudo setup.rb all</pre>

<p>Windows users use ‘ruby setup.rb all’.</p>

<h2>Legal</h2>

<p>(AGPL 3 License)</p>

<p>Copyright © 2007 Thomas Sawyer</p>

<p>Unless otherwise agreed upon by the copyright holder, this program is
ditributed under the terms of the GNU Affero General Public License v3.</p>

<p><a href="Capsule.html">Capsule</a> is based on Joel VanderWerf’s Script
library.</p>

<p>Copyright © 2004 Joel VanderWerf</p>

<p>See <a href="COPYING_rdoc.html">COPYING.rdoc</a> file for details.</p>

  </div>

</div>
</body>
</html>

